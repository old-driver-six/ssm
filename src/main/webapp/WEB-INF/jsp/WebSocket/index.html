<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
<title>后厨界面</title>
    <link rel="stylesheet" href="lib/layui/css/layui.css"media="all" />
    <script src="js/jquery.min.js"></script>
    <style>
        .wid{
            width: 800px;
            margin: 0 auto;
            text-align: center;
        }
    </style>
</head>
<body>
<div class="layui-form wid">
    <table class="layui-table">
        <colgroup>
            <col width="150">
            <col width="200">
            <col width="200">
        </colgroup>
        <thead>
        <tr>
            <th>菜品名称</th>
            <th>数量(份)</th>
            <th>桌号</th>
            <th>确认是否完成</th>
        </tr>
        </thead>
        <tbody id="main">
        <tr>
            <td>火爆小龙虾</td>
            <td>2</td>
            <td>23</td>
            <td>
                <button class="layui-btn layui-btn-normal layui-btn-radius wanc" >已完成</button>
            </td>
        </tr>
        </tbody>
    </table>
    <audio src="music/20190512_211416.mp3" id="muc" controls="controls" hidden="true">
        Your browser does not support the audio element.
    </audio>
</div>
</body>

<script type="text/javascript">
    var websocket = null;
    var usname="1001";
   /* var username = localStorage.getItem("name");*/
    //判断当前浏览器是否支持WebSocket
    if ('WebSocket' in window) {
        websocket = new WebSocket("ws://localhost:8080/WebSoket/websocket/socketServer");
    }
    else {
        alert('当前浏览器 Not support websocket')
    }

    //连接发生错误的回调方法
    websocket.onerror = function () {
        setMessageInnerHTML("WebSocket连接发生错误");
    };

    //连接成功建立的回调方法
    websocket.onopen = function () {
        setMessageInnerHTML("WebSocket连接成功");
    }

    //接收到消息的回调方法
    websocket.onmessage = function (event) {
        show(JSON.parse(event.data))
    }

    //连接关闭的回调方法
    websocket.onclose = function () {
        setMessageInnerHTML("WebSocket连接关闭");
    }

    //监听窗口关闭事件，当窗口关闭时，主动去关闭websocket连接，防止连接还没断开就关闭窗口，server端会抛异常。
    window.onbeforeunload = function () {
        closeWebSocket();
    }

    //将消息显示在网页上
    function setMessageInnerHTML(innerHTML) {
        console.log(innerHTML);
        /*document.getElementById('message').innerHTML += (innerHTML.massg.id+"  "+innerHTML.massg.name+"  "+innerHTML.massg.number) + '<br/>';*/
    }
    //将消息显示在界面上
    function show(arraylist) {
        var auto=document.getElementById("muc");
        if(arraylist.sid){
            var tr=document.createElement("tr");
            tr.innerHTML='<td>'+arraylist.sname+'</td>'+'<td>'+arraylist.snumber+'</td>'+
                '<td>'+arraylist.sid+'</td>'+'<td><button class="layui-btn layui-btn-normal layui-btn-radius wanc" >已完成</button></td>'
            $("#main").append(tr);
            var $del=$(".wanc");
            $del.on("click",function(){
                var tds=$(this).parent().parent();
                tds.remove();
            });
            auto.play();
        }
    }

    //关闭WebSocket连接
    function closeWebSocket() {
        websocket.close();
    }

   /* //发送消息
    function send() {
        var message = document.getElementById('text').value;
        websocket.send(message);
    }*/
</script>
</html>